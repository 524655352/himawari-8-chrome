!function(){"use strict";function n(){}function t(t){function e(){if(!a)try{r()}catch(n){c[h+l-1]&&i(n)}}function r(){for(;a=s&&t>l;){var n=h+l,e=c[n],r=e.length-1,i=e[r];e[r]=o(n),--s,++l,e=i.apply(null,e),c[n]&&(c[n]=e||k)}}function o(n){return function(t,r){c[n]&&(--l,++h,c[n]=null,null==p&&(null!=t?i(t):(f[n]=r,s?e():l||g(p,f))))}}function i(n){var t,e=c.length;for(p=n,f=void 0,s=NaN;--e>=0;)if((t=c[e])&&(c[e]=null,t.abort))try{t.abort()}catch(n){}l=NaN,g(p,f)}if(!(t>=1))throw new Error;var u,a,c=[],f=[],s=0,l=0,h=0,p=null,g=n;return u={defer:function(t){if("function"!=typeof t||g!==n)throw new Error;if(null!=p)return u;var r=R.call(arguments,1);return r.push(t),++s,c.push(r),e(),u},abort:function(){return null==p&&i(new Error("abort")),u},await:function(t){if("function"!=typeof t||g!==n)throw new Error;return g=function(n,e){t.apply(null,[n].concat(e))},l||g(p,f),u},awaitAll:function(t){if("function"!=typeof t||g!==n)throw new Error;return g=t,l||g(p,f),u}}}function e(n){return t(arguments.length?+n:1/0)}function r(){}function o(n,t){var e=new r;if(n instanceof r)n.each(function(n,t){e.set(t,n)});else if(Array.isArray(n)){var o,i=-1,u=n.length;if(null==t)for(;++i<u;)e.set(i,n[i]);else for(;++i<u;)e.set(t(o=n[i],i,n),o)}else if(n)for(var a in n)e.set(a,n[a]);return e}function i(){for(var n,t=0,e=arguments.length,r={};e>t;++t){if(!(n=arguments[t]+"")||n in r)throw new Error("illegal or duplicate type: "+n);r[n]=[]}return new u(r)}function u(n){this._=n}function a(n,t){return n.trim().split(/^|\s+/).map(function(n){var e="",r=n.indexOf(".");if(r>=0&&(e=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:e}})}function c(n,t){for(var e,r=0,o=n.length;o>r;++r)if((e=n[r]).name===t)return e.value}function f(n,t,e){for(var r=0,o=n.length;o>r;++r)if(n[r].name===t){n[r]=O,n=n.slice(0,r).concat(n.slice(r+1));break}return null!=e&&n.push({name:t,value:e}),n}function s(n,t){function e(n){var t,e=p.status;if(!e&&h(p)||e>=200&&300>e||304===e){if(a)try{t=a.call(r,p)}catch(o){return void f.call("error",r,o)}else t=p;f.call("load",r,t)}else f.call("error",r,n)}var r,u,a,c,f=i("beforesend","progress","load","error"),s=o(),p=new XMLHttpRequest,g=0;return"undefined"==typeof XDomainRequest||"withCredentials"in p||!/^(http(s)?:)?\/\//.test(n)||(p=new XDomainRequest),"onload"in p?p.onload=p.onerror=p.ontimeout=e:p.onreadystatechange=function(n){p.readyState>3&&e(n)},p.onprogress=function(n){f.call("progress",r,n)},r={header:function(n,t){return n=(n+"").toLowerCase(),arguments.length<2?s.get(n):(null==t?s.remove(n):s.set(n,t+""),r)},mimeType:function(n){return arguments.length?(u=null==n?null:n+"",r):u},responseType:function(n){return arguments.length?(c=n,r):c},timeout:function(n){return arguments.length?(g=+n,r):g},response:function(n){return a=n,r},get:function(n,t){return r.send("GET",n,t)},post:function(n,t){return r.send("POST",n,t)},send:function(t,e,o){return o||"function"!=typeof e||(o=e,e=null),o&&1===o.length&&(o=l(o)),p.open(t,n,!0),null==u||s.has("accept")||s.set("accept",u+",*/*"),p.setRequestHeader&&s.each(function(n,t){p.setRequestHeader(t,n)}),null!=u&&p.overrideMimeType&&p.overrideMimeType(u),null!=c&&(p.responseType=c),g>0&&(p.timeout=g),o&&r.on("error",o).on("load",function(n){o(null,n)}),f.call("beforesend",r,p),p.send(null==e?null:e),r},abort:function(){return p.abort(),r},on:function(){var n=f.on.apply(f,arguments);return n===f?r:n}},t?r.get(t):r}function l(n){return function(t,e){n(null==t?e:null)}}function h(n){var t=n.responseType;return t&&"text"!==t?n.response:n.responseText}function p(n,t){return function(e,r){var o=s(e).mimeType(n).response(t);return r?o.get(r):o}}function g(n){return new Function("d","return {"+n.map(function(n,t){return JSON.stringify(n)+": d["+t+"]"}).join(",")+"}")}function d(n,t){var e=g(n);return function(r,o){return t(e(r),o,n)}}function v(n){var t=Object.create(null),e=[];return n.forEach(function(n){for(var r in n)r in t||e.push(t[r]=r)}),e}function m(n){function t(n,t){var r,o,i=e(n,function(n,e){return r?r(n,e-1):(o=n,void(r=t?d(n,t):g(n)))});return i.columns=o,i}function e(n,t){function e(){if(s>=f)return u;if(o)return o=!1,i;var t,e=s;if(34===n.charCodeAt(e)){for(var r=e;r++<f;)if(34===n.charCodeAt(r)){if(34!==n.charCodeAt(r+1))break;++r}return s=r+2,t=n.charCodeAt(r+1),13===t?(o=!0,10===n.charCodeAt(r+2)&&++s):10===t&&(o=!0),n.slice(e+1,r).replace(/""/g,'"')}for(;f>s;){var a=1;if(t=n.charCodeAt(s++),10===t)o=!0;else if(13===t)o=!0,10===n.charCodeAt(s)&&(++s,++a);else if(t!==c)continue;return n.slice(e,s-a)}return n.slice(e)}for(var r,o,i={},u={},a=[],f=n.length,s=0,l=0;(r=e())!==u;){for(var h=[];r!==i&&r!==u;)h.push(r),r=e();t&&null==(h=t(h,l++))||a.push(h)}return a}function r(t,e){return null==e&&(e=v(t)),[e.map(u).join(n)].concat(t.map(function(t){return e.map(function(n){return u(t[n])}).join(n)})).join("\n")}function o(n){return n.map(i).join("\n")}function i(t){return t.map(u).join(n)}function u(n){return a.test(n)?'"'+n.replace(/\"/g,'""')+'"':n}var a=new RegExp('["'+n+"\n]"),c=n.charCodeAt(0);return{parse:t,parseRows:e,format:r,formatRows:o}}function w(n){n=n||{};var t=y(n.infrared),e=b(n.date);e=T(e);for(var r=n.blocks||(n.zoom?B[n.zoom-1]:B[0]),o=r+"d",i=[e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds()].map(function(n){return E(n,2)}).join(""),u=e.getUTCFullYear(),a=E(e.getUTCMonth()+1,2),c=E(e.getUTCDate(),2),f=[t,o,q,u,a,c,i].join("/"),s=[],l=0;r>l;l++)for(var h=0;r>h;h++){var p=h+"_"+l+".png",g=f+"_"+p;s.push({name:p,url:C(g),x:h,y:l})}return{tiles:s,blocks:r,date:e}}function y(n){var t=N;return t+=n?_:H}function T(n){return n.setMinutes(n.getMinutes()-n.getMinutes()%10),n.setSeconds(0),n}function b(n){if("string"==typeof n){var t=n.match(/(\d{4})-(\d{2})-(\d{2})\s(\d{2}):(\d{2}):(\d{2})Z/);return t[2]-=1,new Date(Date.UTC.apply(this,t.slice(1)))}return n}function C(n){var t=432e3;return"https://images1-focus-opensocial.googleusercontent.com/gadgets/proxy?url="+n+"&container=focus&refresh="+t}function E(n,t){for(var e=n+"";e.length<t;)e="0"+e;return e}function I(n,t){L("https://pah3rcptrc.execute-api.us-west-2.amazonaws.com/prod/himawari").post(JSON.stringify({type:n?_:H}),function(n,e){if(n)throw n;var r=e.date;t(b(r+"Z"))})}function A(){for(var n=document.getElementById("output").clientHeight*window.devicePixelRatio,t=n/q,e=0;e<B.length;e++){var r=B[e];if(r>t)return r}return B[B.length-1]}function x(n){var t=(Date.now()-n.getTime())/6e4;document.getElementById("time").innerHTML='<abbr title="'+n+'">'+Math.floor(t)+" minutes</abbr> ago"}function S(n){function t(n,t){var e=new Image;e.setAttribute("crossOrigin","anonymous"),e.onload=function(){a.drawImage(e,n.x*q,n.y*q,q,q),t()},e.src=n.url}if(!U||n.getTime()!==U.getTime()){var r=!localStorage.getItem(X),o=w({date:n,blocks:A()}),i=o.blocks*q,u=r?document.getElementById("output"):document.createElement("canvas"),a=u.getContext("2d");a.canvas.width=i,a.canvas.height=i;var c=e();o.tiles.forEach(function(n){c.defer(t,n)}),c.awaitAll(function(t){if(t)throw t;if(!r){var e=document.getElementById("output"),a=e.getContext("2d");a.canvas.width=i,a.canvas.height=i,a.drawImage(u,0,0)}x(o.date),U=n;var c=u.toDataURL("image/jpeg",z);localStorage.setItem(J,c),localStorage.setItem(X,n)})}}function j(){navigator.onLine&&I(!1,function(n){S(n)})}function D(){var n=document.getElementById("output"),t=n.getContext("2d"),e=new Date(localStorage.getItem(X)),r=new Image;r.onload=function(){t.canvas.width=r.width,t.canvas.height=r.height,t.drawImage(r,0,0),x(e),U=e},r.src=localStorage.getItem(J)}var R=[].slice,k={},M="$";r.prototype=o.prototype={constructor:r,has:function(n){return M+n in this},get:function(n){return this[M+n]},set:function(n,t){return this[M+n]=t,this},remove:function(n){var t=M+n;return t in this&&delete this[t]},clear:function(){for(var n in this)n[0]===M&&delete this[n]},keys:function(){var n=[];for(var t in this)t[0]===M&&n.push(t.slice(1));return n},values:function(){var n=[];for(var t in this)t[0]===M&&n.push(this[t]);return n},entries:function(){var n=[];for(var t in this)t[0]===M&&n.push({key:t.slice(1),value:this[t]});return n},size:function(){var n=0;for(var t in this)t[0]===M&&++n;return n},empty:function(){for(var n in this)if(n[0]===M)return!1;return!0},each:function(n){for(var t in this)t[0]===M&&n(this[t],t.slice(1),this)}};var O=(o.prototype,{value:function(){}});u.prototype=i.prototype={constructor:u,on:function(n,t){var e,r=this._,o=a(n+"",r),i=-1,u=o.length;{if(!(arguments.length<2)){for(;++i<u;)if(e=(n=o[i]).type)r[e]=f(r[e],n.name,t);else if(null==t)for(e in r)r[e]=f(r[e],n.name,null);return this}for(;++i<u;)if((e=(n=o[i]).type)&&(e=c(r[e],n.name)))return e}},copy:function(){var n={},t=this._;for(var e in t)n[e]=t[e].slice();return new u(n)},call:function(n,t){if((e=arguments.length-2)>0)for(var e,r=new Array(e),o=0;e>o;++o)r[o]=arguments[o+2];this.apply(n,t,r)},apply:function(n,t,e){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var r=this._[n],o=0,i=r.length;i>o;++o)r[o].value.apply(t,e)}};var U,L=p("application/json",function(n){return JSON.parse(n.responseText)}),N=(m(","),m("	"),"http://himawari8-dl.nict.go.jp/himawari8/img/"),_="INFRARED_FULL",H="D531106",q=550,B=[1,4,8,16,20],z=.9,F=12e4,P=1e4,J="imageData",X="cachedDate";window.setInterval(j,F),window.addEventListener("online",j),localStorage.getItem(X)?(D(),j()):j(),window.setInterval(function(){U&&x(U)},P)}();
//# sourceMappingURL=bundle.js.map