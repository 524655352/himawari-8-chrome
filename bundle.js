!function(){"use strict";function t(t){if(!(t>=1))throw new Error;this._size=t,this._call=this._error=null,this._tasks=[],this._data=[],this._waiting=this._active=this._ended=this._start=0}function n(t){if(!t._start)try{e(t)}catch(n){t._tasks[t._ended+t._active-1]&&o(t,n)}}function e(t){for(;t._start=t._waiting&&t._active<t._size;){var n=t._ended+t._active,e=t._tasks[n],o=e.length-1,i=e[o];e[o]=r(t,n),--t._waiting,++t._active,e=i.apply(null,e),t._tasks[n]&&(t._tasks[n]=e||O)}}function r(t,e){return function(r,a){t._tasks[e]&&(--t._active,++t._ended,t._tasks[e]=null,null==t._error&&(null!=r?o(t,r):(t._data[e]=a,t._waiting?n(t):i(t))))}}function o(t,n){var e,r=t._tasks.length;for(t._error=n,t._data=void 0,t._waiting=NaN;--r>=0;)if((e=t._tasks[r])&&(t._tasks[r]=null,e.abort))try{e.abort()}catch(n){}t._active=NaN,i(t)}function i(t){!t._active&&t._call&&t._call(t._error,t._data)}function a(n){return new t(arguments.length?+n:1/0)}function u(){}function c(t,n){var e=new u;if(t instanceof u)t.each(function(t,n){e.set(n,t)});else if(Array.isArray(t)){var r,o=-1,i=t.length;if(null==n)for(;++o<i;)e.set(o,t[o]);else for(;++o<i;)e.set(n(r=t[o],o,t),r)}else if(t)for(var a in t)e.set(a,t[a]);return e}function s(){for(var t,n=0,e=arguments.length,r={};e>n;++n){if(!(t=arguments[n]+"")||t in r)throw new Error("illegal or duplicate type: "+t);r[t]=[]}return new l(r)}function l(t){this._=t}function f(t,n){return t.trim().split(/^|\s+/).map(function(t){var e="",r=t.indexOf(".");if(r>=0&&(e=t.slice(r+1),t=t.slice(0,r)),t&&!n.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}})}function h(t,n){for(var e,r=0,o=t.length;o>r;++r)if((e=t[r]).name===n)return e.value}function p(t,n,e){for(var r=0,o=t.length;o>r;++r)if(t[r].name===n){t[r]=N,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=e&&t.push({name:n,value:e}),t}function d(t,n){function e(t){var n,e=f.status;if(!e&&v(f)||e>=200&&300>e||304===e){if(i)try{n=i.call(r,f)}catch(o){return void u.call("error",r,o)}else n=f;u.call("load",r,n)}else u.call("error",r,t)}var r,o,i,a,u=s("beforesend","progress","load","error"),l=c(),f=new XMLHttpRequest,h=null,p=null,d=0;return"undefined"==typeof XDomainRequest||"withCredentials"in f||!/^(http(s)?:)?\/\//.test(t)||(f=new XDomainRequest),"onload"in f?f.onload=f.onerror=f.ontimeout=e:f.onreadystatechange=function(t){f.readyState>3&&e(t)},f.onprogress=function(t){u.call("progress",r,t)},r={header:function(t,n){return t=(t+"").toLowerCase(),arguments.length<2?l.get(t):(null==n?l.remove(t):l.set(t,n+""),r)},mimeType:function(t){return arguments.length?(o=null==t?null:t+"",r):o},responseType:function(t){return arguments.length?(a=t,r):a},timeout:function(t){return arguments.length?(d=+t,r):d},user:function(t){return arguments.length<1?h:(h=null==t?null:t+"",r)},password:function(t){return arguments.length<1?p:(p=null==t?null:t+"",r)},response:function(t){return i=t,r},get:function(t,n){return r.send("GET",t,n)},post:function(t,n){return r.send("POST",t,n)},send:function(n,e,i){return i||"function"!=typeof e||(i=e,e=null),i&&1===i.length&&(i=g(i)),f.open(n,t,!0,h,p),null==o||l.has("accept")||l.set("accept",o+",*/*"),f.setRequestHeader&&l.each(function(t,n){f.setRequestHeader(n,t)}),null!=o&&f.overrideMimeType&&f.overrideMimeType(o),null!=a&&(f.responseType=a),d>0&&(f.timeout=d),i&&r.on("error",i).on("load",function(t){i(null,t)}),u.call("beforesend",r,f),f.send(null==e?null:e),r},abort:function(){return f.abort(),r},on:function(){var t=u.on.apply(u,arguments);return t===u?r:t}},n?r.get(n):r}function g(t){return function(n,e){t(null==n?e:null)}}function v(t){var n=t.responseType;return n&&"text"!==n?t.response:t.responseText}function m(t,n){return function(e,r){var o=d(e).mimeType(t).response(n);return r?o.get(r):o}}function w(t){return new Function("d","return {"+t.map(function(t,n){return JSON.stringify(t)+": d["+n+"]"}).join(",")+"}")}function y(t,n){var e=w(t);return function(r,o){return n(e(r),o,t)}}function _(t){var n=Object.create(null),e=[];return t.forEach(function(t){for(var r in t)r in n||e.push(n[r]=r)}),e}function T(t){function n(t,n){var r,o,i=e(t,function(t,e){return r?r(t,e-1):(o=t,void(r=n?y(t,n):w(t)))});return i.columns=o,i}function e(t,n){function e(){if(l>=s)return a;if(o)return o=!1,i;var n,e=l;if(34===t.charCodeAt(e)){for(var r=e;r++<s;)if(34===t.charCodeAt(r)){if(34!==t.charCodeAt(r+1))break;++r}return l=r+2,n=t.charCodeAt(r+1),13===n?(o=!0,10===t.charCodeAt(r+2)&&++l):10===n&&(o=!0),t.slice(e+1,r).replace(/""/g,'"')}for(;s>l;){var u=1;if(n=t.charCodeAt(l++),10===n)o=!0;else if(13===n)o=!0,10===t.charCodeAt(l)&&(++l,++u);else if(n!==c)continue;return t.slice(e,l-u)}return t.slice(e)}for(var r,o,i={},a={},u=[],s=t.length,l=0,f=0;(r=e())!==a;){for(var h=[];r!==i&&r!==a;)h.push(r),r=e();n&&null==(h=n(h,f++))||u.push(h)}return u}function r(n,e){return null==e&&(e=_(n)),[e.map(a).join(t)].concat(n.map(function(n){return e.map(function(t){return a(n[t])}).join(t)})).join("\n")}function o(t){return t.map(i).join("\n")}function i(n){return n.map(a).join(t)}function a(t){return u.test(t)?'"'+t.replace(/\"/g,'""')+'"':t}var u=new RegExp('["'+t+"\n]"),c=t.charCodeAt(0);return{parse:n,parseRows:e,format:r,formatRows:o}}function I(t){t=t||{};var n=k(t.infrared),e=b(t.date);e=E(e);for(var r=t.blocks||(t.zoom?F[t.zoom-1]:F[0]),o=r+"d",i=[e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds()].map(function(t){return A(t,2)}).join(""),a=e.getUTCFullYear(),u=A(e.getUTCMonth()+1,2),c=A(e.getUTCDate(),2),s=[n,o,P,a,u,c,i].join("/"),l=[],f=0;r>f;f++)for(var h=0;r>h;h++){var p=h+"_"+f+".png",d=s+"_"+p;l.push({name:p,url:C(d),x:h,y:f})}return{tiles:l,blocks:r,date:e}}function k(t){var n=H;return n+=t?q:z}function E(t){return t.setMinutes(t.getMinutes()-t.getMinutes()%10),t.setSeconds(0),t}function b(t){if("string"==typeof t){var n=t.match(/(\d{4})-(\d{2})-(\d{2})\s(\d{2}):(\d{2}):(\d{2})Z/);return n[2]-=1,new Date(Date.UTC.apply(this,n.slice(1)))}return t}function C(t){var n=432e3;return"https://images1-focus-opensocial.googleusercontent.com/gadgets/proxy?url="+t+"&container=focus&refresh="+n}function A(t,n){for(var e=t+"";e.length<n;)e="0"+e;return e}function S(t,n){B("https://himawari-8.appspot.com/latest"+(t?"?infrared=true":""),function(t,e){if(t)throw t;var r=e.date;n(b(r+"Z"))})}function x(){for(var t=document.getElementById("output").clientHeight*window.devicePixelRatio,n=t/P,e=0;e<F.length;e++){var r=F[e];if(r>n)return r}return F[F.length-1]}function D(t){var n=(Date.now()-t.getTime())/6e4;document.getElementById("time").innerHTML='<abbr title="'+t+'">'+Math.floor(n)+" minutes</abbr> ago"}function j(t,n){function e(t,n){var e=new Image;e.setAttribute("crossOrigin","anonymous"),e.onload=function(){c.drawImage(e,t.x*P,t.y*P,P,P),n()},e.src=t.url}if(!Q||t.getTime()!==Q.getTime()||V!==(n?q:z)){var r=!localStorage.getItem(Y),o=I({date:t,blocks:x(),infrared:n}),i=o.blocks*P,u=r?document.getElementById("output"):document.createElement("canvas"),c=u.getContext("2d");c.canvas.width=i,c.canvas.height=i;var s=a();o.tiles.forEach(function(t){s.defer(e,t)}),s.awaitAll(function(e){if(e)throw e;if(!r){var a=document.getElementById("output"),c=a.getContext("2d");c.canvas.width=i,c.canvas.height=i,c.drawImage(u,0,0)}D(o.date),Q=t,V=n?q:z;var s=u.toDataURL("image/jpeg",X);localStorage.setItem(G,s),localStorage.setItem(Y,t),localStorage.setItem($,n?q:z)})}}function R(){function t(t){S(t,function(n){j(n,t)})}navigator.onLine&&(K?chrome.storage.sync.get({imageType:z},function(n){var e=n.imageType===q;t(e)}):t(!1))}function M(){var t=document.getElementById("output"),n=t.getContext("2d"),e=new Date(localStorage.getItem(Y)),r=new Image;r.onload=function(){n.canvas.width=r.width,n.canvas.height=r.height,n.drawImage(r,0,0),D(e),Q=e,V=localStorage.getItem($)},r.src=localStorage.getItem(G)}var L=[].slice,O={};t.prototype=a.prototype={constructor:t,defer:function(t){if("function"!=typeof t||this._call)throw new Error;if(null!=this._error)return this;var e=L.call(arguments,1);return e.push(t),++this._waiting,this._tasks.push(e),n(this),this},abort:function(){return null==this._error&&o(this,new Error("abort")),this},await:function(t){if("function"!=typeof t||this._call)throw new Error;return this._call=function(n,e){t.apply(null,[n].concat(e))},i(this),this},awaitAll:function(t){if("function"!=typeof t||this._call)throw new Error;return this._call=t,i(this),this}};var U="$";u.prototype=c.prototype={constructor:u,has:function(t){return U+t in this},get:function(t){return this[U+t]},set:function(t,n){return this[U+t]=n,this},remove:function(t){var n=U+t;return n in this&&delete this[n]},clear:function(){for(var t in this)t[0]===U&&delete this[t]},keys:function(){var t=[];for(var n in this)n[0]===U&&t.push(n.slice(1));return t},values:function(){var t=[];for(var n in this)n[0]===U&&t.push(this[n]);return t},entries:function(){var t=[];for(var n in this)n[0]===U&&t.push({key:n.slice(1),value:this[n]});return t},size:function(){var t=0;for(var n in this)n[0]===U&&++t;return t},empty:function(){for(var t in this)if(t[0]===U)return!1;return!0},each:function(t){for(var n in this)n[0]===U&&t(this[n],n.slice(1),this)}};var N=(c.prototype,{value:function(){}});l.prototype=s.prototype={constructor:l,on:function(t,n){var e,r=this._,o=f(t+"",r),i=-1,a=o.length;{if(!(arguments.length<2)){for(;++i<a;)if(e=(t=o[i]).type)r[e]=p(r[e],t.name,n);else if(null==n)for(e in r)r[e]=p(r[e],t.name,null);return this}for(;++i<a;)if((e=(t=o[i]).type)&&(e=h(r[e],t.name)))return e}},copy:function(){var t={},n=this._;for(var e in n)t[e]=n[e].slice();return new l(t)},call:function(t,n){if((e=arguments.length-2)>0)for(var e,r=new Array(e),o=0;e>o;++o)r[o]=arguments[o+2];this.apply(t,n,r)},apply:function(t,n,e){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],o=0,i=r.length;i>o;++o)r[o].value.apply(n,e)}};var B=m("application/json",function(t){return JSON.parse(t.responseText)}),H=(T(","),T("	"),"http://himawari8-dl.nict.go.jp/himawari8/img/"),q="INFRARED_FULL",z="D531106",P=550,F=[1,4,8,16,20],X=.9,J=6e4,Z=1e4,G="imageData",Y="cachedDate",$="cachedImageType",K=window.chrome&&chrome.app.getDetails(),Q=null,V=null;window.setInterval(R,J),window.addEventListener("online",R),localStorage.getItem(Y)&&M(),R(),window.setInterval(function(){Q&&D(Q)},Z),K&&(document.body.className+="extension",document.getElementById("go-to-options").addEventListener("click",function(){chrome.runtime.openOptionsPage()}))}();
//# sourceMappingURL=bundle.js.map