!function(){"use strict";function n(){}function t(t){function e(){if(!a)try{r()}catch(n){c[h+s-1]&&i(n)}}function r(){for(;a=f&&t>s;){var n=h+s,e=c[n],r=e.length-1,i=e[r];e[r]=o(n),--f,++s,e=i.apply(null,e),c[n]&&(c[n]=e||k)}}function o(n){return function(t,r){c[n]&&(--s,++h,c[n]=null,null==p&&(null!=t?i(t):(l[n]=r,f?e():s||g(p,l))))}}function i(n){var t,e=c.length;for(p=n,l=void 0,f=NaN;--e>=0;)if((t=c[e])&&(c[e]=null,t.abort))try{t.abort()}catch(n){}s=NaN,g(p,l)}if(!(t>=1))throw new Error;var u,a,c=[],l=[],f=0,s=0,h=0,p=null,g=n;return u={defer:function(t){if("function"!=typeof t||g!==n)throw new Error;if(null!=p)return u;var r=R.call(arguments,1);return r.push(t),++f,c.push(r),e(),u},abort:function(){return null==p&&i(new Error("abort")),u},await:function(t){if("function"!=typeof t||g!==n)throw new Error;return g=function(n,e){t.apply(null,[n].concat(e))},s||g(p,l),u},awaitAll:function(t){if("function"!=typeof t||g!==n)throw new Error;return g=t,s||g(p,l),u}}}function e(n){return t(arguments.length?+n:1/0)}function r(){}function o(n,t){var e=new r;if(n instanceof r)n.each(function(n,t){e.set(t,n)});else if(Array.isArray(n)){var o,i=-1,u=n.length;if(null==t)for(;++i<u;)e.set(i,n[i]);else for(;++i<u;)e.set(t(o=n[i],i,n),o)}else if(n)for(var a in n)e.set(a,n[a]);return e}function i(){for(var n,t=0,e=arguments.length,r={};e>t;++t){if(!(n=arguments[t]+"")||n in r)throw new Error("illegal or duplicate type: "+n);r[n]=[]}return new u(r)}function u(n){this._=n}function a(n,t){return n.trim().split(/^|\s+/).map(function(n){var e="",r=n.indexOf(".");if(r>=0&&(e=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:e}})}function c(n,t){for(var e,r=0,o=n.length;o>r;++r)if((e=n[r]).name===t)return e.value}function l(n,t,e){for(var r=0,o=n.length;o>r;++r)if(n[r].name===t){n[r]=L,n=n.slice(0,r).concat(n.slice(r+1));break}return null!=e&&n.push({name:t,value:e}),n}function f(n,t){function e(n){var t,e=p.status;if(!e&&h(p)||e>=200&&300>e||304===e){if(a)try{t=a.call(r,p)}catch(o){return void l.call("error",r,o)}else t=p;l.call("load",r,t)}else l.call("error",r,n)}var r,u,a,c,l=i("beforesend","progress","load","error"),f=o(),p=new XMLHttpRequest,g=null,d=null,v=0;return"undefined"==typeof XDomainRequest||"withCredentials"in p||!/^(http(s)?:)?\/\//.test(n)||(p=new XDomainRequest),"onload"in p?p.onload=p.onerror=p.ontimeout=e:p.onreadystatechange=function(n){p.readyState>3&&e(n)},p.onprogress=function(n){l.call("progress",r,n)},r={header:function(n,t){return n=(n+"").toLowerCase(),arguments.length<2?f.get(n):(null==t?f.remove(n):f.set(n,t+""),r)},mimeType:function(n){return arguments.length?(u=null==n?null:n+"",r):u},responseType:function(n){return arguments.length?(c=n,r):c},timeout:function(n){return arguments.length?(v=+n,r):v},user:function(n){return arguments.length<1?g:(g=null==n?null:n+"",r)},password:function(n){return arguments.length<1?d:(d=null==n?null:n+"",r)},response:function(n){return a=n,r},get:function(n,t){return r.send("GET",n,t)},post:function(n,t){return r.send("POST",n,t)},send:function(t,e,o){return o||"function"!=typeof e||(o=e,e=null),o&&1===o.length&&(o=s(o)),p.open(t,n,!0,g,d),null==u||f.has("accept")||f.set("accept",u+",*/*"),p.setRequestHeader&&f.each(function(n,t){p.setRequestHeader(t,n)}),null!=u&&p.overrideMimeType&&p.overrideMimeType(u),null!=c&&(p.responseType=c),v>0&&(p.timeout=v),o&&r.on("error",o).on("load",function(n){o(null,n)}),l.call("beforesend",r,p),p.send(null==e?null:e),r},abort:function(){return p.abort(),r},on:function(){var n=l.on.apply(l,arguments);return n===l?r:n}},t?r.get(t):r}function s(n){return function(t,e){n(null==t?e:null)}}function h(n){var t=n.responseType;return t&&"text"!==t?n.response:n.responseText}function p(n,t){return function(e,r){var o=f(e).mimeType(n).response(t);return r?o.get(r):o}}function g(n){return new Function("d","return {"+n.map(function(n,t){return JSON.stringify(n)+": d["+t+"]"}).join(",")+"}")}function d(n,t){var e=g(n);return function(r,o){return t(e(r),o,n)}}function v(n){var t=Object.create(null),e=[];return n.forEach(function(n){for(var r in n)r in t||e.push(t[r]=r)}),e}function m(n){function t(n,t){var r,o,i=e(n,function(n,e){return r?r(n,e-1):(o=n,void(r=t?d(n,t):g(n)))});return i.columns=o,i}function e(n,t){function e(){if(f>=l)return u;if(o)return o=!1,i;var t,e=f;if(34===n.charCodeAt(e)){for(var r=e;r++<l;)if(34===n.charCodeAt(r)){if(34!==n.charCodeAt(r+1))break;++r}return f=r+2,t=n.charCodeAt(r+1),13===t?(o=!0,10===n.charCodeAt(r+2)&&++f):10===t&&(o=!0),n.slice(e+1,r).replace(/""/g,'"')}for(;l>f;){var a=1;if(t=n.charCodeAt(f++),10===t)o=!0;else if(13===t)o=!0,10===n.charCodeAt(f)&&(++f,++a);else if(t!==c)continue;return n.slice(e,f-a)}return n.slice(e)}for(var r,o,i={},u={},a=[],l=n.length,f=0,s=0;(r=e())!==u;){for(var h=[];r!==i&&r!==u;)h.push(r),r=e();t&&null==(h=t(h,s++))||a.push(h)}return a}function r(t,e){return null==e&&(e=v(t)),[e.map(u).join(n)].concat(t.map(function(t){return e.map(function(n){return u(t[n])}).join(n)})).join("\n")}function o(n){return n.map(i).join("\n")}function i(t){return t.map(u).join(n)}function u(n){return a.test(n)?'"'+n.replace(/\"/g,'""')+'"':n}var a=new RegExp('["'+n+"\n]"),c=n.charCodeAt(0);return{parse:t,parseRows:e,format:r,formatRows:o}}function y(n){n=n||{};var t=w(n.infrared),e=I(n.date);e=T(e);for(var r=n.blocks||(n.zoom?H[n.zoom-1]:H[0]),o=r+"d",i=[e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds()].map(function(n){return b(n,2)}).join(""),u=e.getUTCFullYear(),a=b(e.getUTCMonth()+1,2),c=b(e.getUTCDate(),2),l=[t,o,B,u,a,c,i].join("/"),f=[],s=0;r>s;s++)for(var h=0;r>h;h++){var p=h+"_"+s+".png",g=l+"_"+p;f.push({name:p,url:E(g),x:h,y:s})}return{tiles:f,blocks:r,date:e}}function w(n){var t=U;return t+=n?N:_}function T(n){return n.setMinutes(n.getMinutes()-n.getMinutes()%10),n.setSeconds(0),n}function I(n){if("string"==typeof n){var t=n.match(/(\d{4})-(\d{2})-(\d{2})\s(\d{2}):(\d{2}):(\d{2})Z/);return t[2]-=1,new Date(Date.UTC.apply(this,t.slice(1)))}return n}function E(n){var t=432e3;return"https://images1-focus-opensocial.googleusercontent.com/gadgets/proxy?url="+n+"&container=focus&refresh="+t}function b(n,t){for(var e=n+"";e.length<t;)e="0"+e;return e}function C(n,t){O("https://himawari-8.appspot.com/latest"+(n?"?infrared=true":""),function(n,e){if(n)throw n;var r=e.date;t(I(r+"Z"))})}function A(){for(var n=document.getElementById("output").clientHeight*window.devicePixelRatio,t=n/B,e=0;e<H.length;e++){var r=H[e];if(r>t)return r}return H[H.length-1]}function S(n){var t=(Date.now()-n.getTime())/6e4;document.getElementById("time").innerHTML='<abbr title="'+n+'">'+Math.floor(t)+" minutes</abbr> ago"}function x(n,t){function r(n,t){var e=new Image;e.setAttribute("crossOrigin","anonymous"),e.onload=function(){c.drawImage(e,n.x*B,n.y*B,B,B),t()},e.src=n.url}if(!G||n.getTime()!==G.getTime()||Y!==(t?N:_)){var o=!localStorage.getItem(X),i=y({date:n,blocks:A(),infrared:t}),u=i.blocks*B,a=o?document.getElementById("output"):document.createElement("canvas"),c=a.getContext("2d");c.canvas.width=u,c.canvas.height=u;var l=e();i.tiles.forEach(function(n){l.defer(r,n)}),l.awaitAll(function(e){if(e)throw e;if(!o){var r=document.getElementById("output"),c=r.getContext("2d");c.canvas.width=u,c.canvas.height=u,c.drawImage(a,0,0)}S(i.date),G=n,Y=t?N:_;var l=a.toDataURL("image/jpeg",q);localStorage.setItem(z,l),localStorage.setItem(X,n),localStorage.setItem(J,t?N:_)})}}function D(){function n(n){C(n,function(t){x(t,n)})}navigator.onLine&&(Z?chrome.storage.sync.get({imageType:_},function(t){var e=t.imageType===N;n(e)}):n(!1))}function j(){var n=document.getElementById("output"),t=n.getContext("2d"),e=new Date(localStorage.getItem(X)),r=new Image;r.onload=function(){t.canvas.width=r.width,t.canvas.height=r.height,t.drawImage(r,0,0),S(e),G=e,Y=localStorage.getItem(J)},r.src=localStorage.getItem(z)}var R=[].slice,k={},M="$";r.prototype=o.prototype={constructor:r,has:function(n){return M+n in this},get:function(n){return this[M+n]},set:function(n,t){return this[M+n]=t,this},remove:function(n){var t=M+n;return t in this&&delete this[t]},clear:function(){for(var n in this)n[0]===M&&delete this[n]},keys:function(){var n=[];for(var t in this)t[0]===M&&n.push(t.slice(1));return n},values:function(){var n=[];for(var t in this)t[0]===M&&n.push(this[t]);return n},entries:function(){var n=[];for(var t in this)t[0]===M&&n.push({key:t.slice(1),value:this[t]});return n},size:function(){var n=0;for(var t in this)t[0]===M&&++n;return n},empty:function(){for(var n in this)if(n[0]===M)return!1;return!0},each:function(n){for(var t in this)t[0]===M&&n(this[t],t.slice(1),this)}};var L=(o.prototype,{value:function(){}});u.prototype=i.prototype={constructor:u,on:function(n,t){var e,r=this._,o=a(n+"",r),i=-1,u=o.length;{if(!(arguments.length<2)){for(;++i<u;)if(e=(n=o[i]).type)r[e]=l(r[e],n.name,t);else if(null==t)for(e in r)r[e]=l(r[e],n.name,null);return this}for(;++i<u;)if((e=(n=o[i]).type)&&(e=c(r[e],n.name)))return e}},copy:function(){var n={},t=this._;for(var e in t)n[e]=t[e].slice();return new u(n)},call:function(n,t){if((e=arguments.length-2)>0)for(var e,r=new Array(e),o=0;e>o;++o)r[o]=arguments[o+2];this.apply(n,t,r)},apply:function(n,t,e){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var r=this._[n],o=0,i=r.length;i>o;++o)r[o].value.apply(t,e)}};var O=p("application/json",function(n){return JSON.parse(n.responseText)}),U=(m(","),m("	"),"http://himawari8-dl.nict.go.jp/himawari8/img/"),N="INFRARED_FULL",_="D531106",B=550,H=[1,4,8,16,20],q=.9,P=6e4,F=1e4,z="imageData",X="cachedDate",J="cachedImageType",Z=chrome&&chrome.app.getDetails(),G=null,Y=null;window.setInterval(D,P),window.addEventListener("online",D),localStorage.getItem(X)&&j(),D(),window.setInterval(function(){G&&S(G)},F),Z&&(document.body.className+="extension",document.getElementById("go-to-options").addEventListener("click",function(){chrome.runtime.openOptionsPage()}))}();
//# sourceMappingURL=bundle.js.map